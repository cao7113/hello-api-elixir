name: Docker Try
on:
  push:
    branches: ["docker"]

permissions:
  contents: read

jobs:
  test-docker:
    runs-on: ubuntu-latest
    services:
      api-server:
        image: cao7113/hello-api-elixir
        ports:
          - 4000:4000
      # Fix: unsupported media type application/vnd.oci.empty.v1+json
      # use ghcr.io/cao7113/hello-api-elixir:v0.1.8 or ghcr.io/cao7113/hello-api-elixir:latest instead of ghcr.io/cao7113/hello-api-elixir:sha256-b3de0aa2c4d72189aeb6e36fe8377400e1f9e6f4fbc60270b3e05b2e3350462b
      api-server2:
        # https://github.com/cao7113/hello-api-elixir/pkgs/container/hello-api-elixir
        image: ghcr.io/cao7113/hello-api-elixir:v0.1.8
        ports:
          - 4002:4000

    steps:
      # - name: Checkout code
      #   uses: actions/checkout@v4

      - name: Ping api-server
        run: |
          sleep 1
          curl -sSL http://localhost:4000/ping
          curl -sSL http://localhost:4002/ping

      - name: Api build info
        run: |
          curl -sSL http://localhost:4000 | jq
          curl -sSL http://localhost:4002 | jq
